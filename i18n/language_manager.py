"""
Language manager providing simple dictionary-based translations and RTL handling.
"""

from typing import Dict


class LanguageManager:
    """Minimal i18n layer for the app."""

    SUPPORTED = {
        'en': 'English',
        'fr': 'Français',
        'ar': 'العربية',
    }

    def __init__(self) -> None:
        self._lang = 'en'
        # Keys are semantic identifiers used across the UI
        self._translations: Dict[str, Dict[str, str]] = {
            'en': {
                'app.window_title': 'AG Food - Stock & Invoice Manager',
                'nav.stock_management': 'Stock Management',
                'nav.invoice_generation': 'Invoice Generation',
                'nav.client_management': 'Clients',
                'nav.inventory_control': 'Inventory Control',
                'nav.order_processing': 'Order Processing',
                'nav.supplier_management': 'Supplier Management',
                'nav.reports_analytics': 'Reports & Analytics',
                'nav.quality_control': 'Quality Control',
                'nav.settings': 'Settings',
                'settings.tab.general': 'General',
                'settings.tab.locations': 'Locations',
                'settings.language.label': 'Application Language',
                'settings.language.description': 'Choose the language for the app UI.',
                'content.stock.placeholder': 'Stock Management UI will be here.',
                'content.invoice.placeholder': 'Invoice Generation UI will be here.',
                'content.settings.placeholder': 'Settings UI will be here.',
                'stock.search.placeholder': 'Search products...',
                'stock.add': 'Add',
                'stock.edit': 'Edit',
                'stock.delete': 'Delete',
                'stock.restock': '+ Stock',
                'stock.consume': '- Stock',
                'stock.btn.adjust': 'Adjust…',
                'stock.btn.transfer': 'Transfer…',
                'stock.btn.batch': 'Batch/Expiry…',
                'stock.btn.reorder': 'Reorder…',
                'stock.btn.stocktake': 'Stocktake…',
                'stock.btn.history': 'History…',
                'stock.btn.export': 'Export…',
                'stock.col.id': 'ID',
                'stock.col.name': 'Name',
                'stock.col.barcode': 'Barcode',
                'stock.col.quantity': 'Quantity',
                'stock.col.price': 'Price',
                'stock.col.code': 'Code',
                'stock.col.category': 'Category',
                'stock.col.expiry': 'Expiry',
                'stock.col.location': 'Location',
                'stock.col.status': 'Status',
                'stock.all_locations': 'All Locations',
                'stock.form.barcode': 'Barcode',
                'stock.form.sku': 'SKU',
                'stock.form.name': 'Name',
                'stock.form.category': 'Category',
                'stock.form.quantity': 'Quantity',
                'stock.form.unit': 'Unit',
                'stock.form.cost_price': 'Cost Price',
                'stock.form.selling_price': 'Selling Price',
                'stock.form.expiry_date': 'Expiry Date',
                'stock.form.location': 'Location',
                'stock.form.reorder_level': 'Reorder Level',
                'stock.form.supplier': 'Supplier',
                'stock.form.batch_no': 'Batch No.',
                'stock.form.mfg_date': 'Mfg Date',
                'stock.form.notes': 'Notes',
                'stock.more_details.show': 'More Details ▾',
                'stock.more_details.hide': 'More Details ▴',
                'stock.dialog.name': 'Name',
                'stock.dialog.barcode': 'Barcode',
                'stock.dialog.description': 'Description',
                'stock.dialog.quantity': 'Quantity',
                'stock.dialog.price': 'Price',
                'stock.adjust.title': 'Adjust Stock',
                'stock.adjust.amount': 'Amount',
                'stock.scan.placeholder': 'Scan or type barcode and press Enter',
                'stock.scan.exists_prompt': 'Product exists. Increase stock by 1?',
                'msg.validation': 'Validation',
                'msg.name_required': 'Name is required',
                'msg.select_product': 'Select a product first',
                'msg.select_to_edit': 'Select a product to edit',
                'msg.select_to_delete': 'Select a product to delete',
                'msg.error': 'Error',
                'msg.failed_add': 'Failed to add product. Name must be unique.',
                'msg.failed_update': 'Failed to update product (duplicate name?)',
                'msg.failed_delete': 'Failed to delete product',
                'msg.failed_adjust': 'Failed to adjust stock',
                'msg.confirm': 'Confirm',
                'msg.confirm_delete': 'Delete selected product?',
                
                # Clients
                'clients.title': 'Clients',
                'clients.search.placeholder': 'Search clients by name, phone, or email...',
                'clients.name': 'Name',
                'clients.phone': 'Phone',
                'clients.email': 'Email',
                'clients.address': 'Address',
                'clients.city': 'City',
                'clients.state': 'State/Province',
                'clients.postal': 'Postal Code',
                'clients.country': 'Country',
                'clients.dob': 'Date of Birth',
                'clients.gender': 'Gender',
                'clients.notes': 'Notes',
                'clients.balance': 'Balance',
                'clients.last_purchase': 'Last Purchase',
                'clients.history': 'History',
                'clients.recommend': 'Recommend',
                'clients.recommend.none': 'No recommendations available yet.',
                'clients.dialog.title': 'Client Details',
                'clients.payment.title': 'Record Payment',
                'clients.payment.amount': 'Amount',
                'clients.payment.method': 'Method',
                'clients.payment.reference': 'Reference',
                'clients.payment.record': 'Record Payment',
                'clients.msg.select_client': 'Select a client first',
                'clients.msg.failed_add': 'Failed to add client (duplicate email?)',
                'clients.msg.failed_update': 'Failed to update client (duplicate email?)',
                'clients.msg.failed_delete_in_use': 'Cannot delete a client with invoices or payments',
                'clients.msg.failed_payment': 'Failed to record payment',
                
                # Business Information
                'business.name': 'Business Name',
                'business.address': 'Business Address',
                'business.phone_landline': 'Landline Phone',
                'business.phone_mobile': 'Mobile Phone',
                'business.fax': 'Fax',
                'business.email': 'Email',
                'business.bank_identity': 'Bank Identity Statement',
                'business.bank_name': 'Bank Name',
                'business.company_id': 'Common Company Identifier',
                'business.tax_id': 'Tax Identifier',
                'business.patente': 'Patente Number',
                'business.trade_register': 'Trade Register Number',
            },
            'fr': {
                'app.window_title': 'AG Food - Gestion de Stock et Factures',
                'nav.stock_management': 'Gestion des stocks',
                'nav.invoice_generation': 'Génération de factures',
                'nav.inventory_control': 'Contrôle d’inventaire',
                'nav.order_processing': 'Traitement des commandes',
                'nav.supplier_management': 'Gestion des fournisseurs',
                'nav.reports_analytics': 'Rapports et analyses',
                'nav.quality_control': 'Contrôle qualité',
                'nav.settings': 'Paramètres',
                'settings.tab.general': 'Général',
                'settings.tab.locations': 'Emplacements',
                'settings.language.label': 'Langue de l’application',
                'settings.language.description': 'Choisissez la langue de l’interface.',
                'content.stock.placeholder': 'L’interface de gestion des stocks sera ici.',
                'content.invoice.placeholder': 'L’interface de génération de factures sera ici.',
                'content.settings.placeholder': 'L’interface des paramètres sera ici.',
                'stock.search.placeholder': 'Rechercher des produits…',
                'stock.add': 'Ajouter',
                'stock.edit': 'Modifier',
                'stock.delete': 'Supprimer',
                'stock.restock': '+ Stock',
                'stock.consume': '- Stock',
                'stock.btn.adjust': 'Ajuster…',
                'stock.btn.transfer': 'Transférer…',
                'stock.btn.batch': 'Lot/Péremption…',
                'stock.btn.reorder': 'Réappro…',
                'stock.btn.stocktake': 'Inventaire…',
                'stock.btn.history': 'Historique…',
                'stock.btn.export': 'Exporter…',
                'stock.col.id': 'ID',
                'stock.col.name': 'Nom',
                'stock.col.barcode': 'Code-barres',
                'stock.col.quantity': 'Quantité',
                'stock.col.price': 'Prix',
                'stock.col.code': 'Code',
                'stock.col.category': 'Catégorie',
                'stock.col.expiry': 'Péremption',
                'stock.col.location': 'Emplacement',
                'stock.col.status': 'Statut',
                'stock.all_locations': 'Tous les emplacements',
                'stock.form.barcode': 'Code-barres',
                'stock.form.sku': 'SKU',
                'stock.form.name': 'Nom',
                'stock.form.category': 'Catégorie',
                'stock.form.quantity': 'Quantité',
                'stock.form.unit': 'Unité',
                'stock.form.cost_price': 'Prix d’achat',
                'stock.form.selling_price': 'Prix de vente',
                'stock.form.expiry_date': 'Date de péremption',
                'stock.form.location': 'Emplacement',
                'stock.form.reorder_level': 'Seuil de réapprovisionnement',
                'stock.form.supplier': 'Fournisseur',
                'stock.form.batch_no': 'N° de lot',
                'stock.form.mfg_date': 'Date de fabrication',
                'stock.form.notes': 'Notes',
                'stock.more_details.show': 'Plus de détails ▾',
                'stock.more_details.hide': 'Plus de détails ▴',
                'stock.dialog.name': 'Nom',
                'stock.dialog.barcode': 'Code-barres',
                'stock.dialog.description': 'Description',
                'stock.dialog.quantity': 'Quantité',
                'stock.dialog.price': 'Prix',
                'stock.adjust.title': 'Ajuster le stock',
                'stock.adjust.amount': 'Quantité',
                'stock.scan.placeholder': 'Scannez ou saisissez le code et Entrée',
                'stock.scan.exists_prompt': 'Le produit existe. Augmenter le stock de 1 ?',
                'msg.validation': 'Validation',
                'msg.name_required': 'Le nom est obligatoire',
                'msg.select_product': 'Sélectionnez un produit',
                'msg.select_to_edit': 'Sélectionnez un produit à modifier',
                'msg.select_to_delete': 'Sélectionnez un produit à supprimer',
                'msg.error': 'Erreur',
                'msg.failed_add': 'Échec de l’ajout. Le nom doit être unique.',
                'msg.failed_update': 'Échec de la mise à jour (nom en double ?)',
                'msg.failed_delete': 'Échec de la suppression',
                'msg.failed_adjust': 'Échec de l’ajustement du stock',
                'msg.confirm': 'Confirmer',
                'msg.confirm_delete': 'Supprimer le produit sélectionné ?',
                
                # Business Information
                'business.name': 'Nom de l\'entreprise',
                'business.address': 'Adresse de l\'entreprise',
                'business.phone_landline': 'Téléphone fixe',
                'business.phone_mobile': 'Téléphone mobile',
                'business.fax': 'Fax',
                'business.email': 'Courriel',
                'business.bank_identity': 'Relevé d\'identité bancaire',
                'business.bank_name': 'Nom de la banque',
                'business.company_id': 'Identifiant commun de l\'entreprise',
                'business.tax_id': 'Identifiant fiscal',
                'business.patente': 'Numéro de patente',
                'business.trade_register': 'Numéro de registre du commerce',
            },
            'ar': {
                'app.window_title': 'AG Food - إدارة المخزون والفواتير',
                'nav.stock_management': 'إدارة المخزون',
                'nav.invoice_generation': 'إنشاء الفواتير',
                'nav.inventory_control': 'مراقبة المخزون',
                'nav.order_processing': 'معالجة الطلبات',
                'nav.supplier_management': 'إدارة المورّدين',
                'nav.reports_analytics': 'التقارير والتحليلات',
                'nav.quality_control': 'مراقبة الجودة',
                'nav.settings': 'الإعدادات',
                'settings.tab.general': 'عام',
                'settings.tab.locations': 'المواقع',
                'settings.language.label': 'لغة التطبيق',
                'settings.language.description': 'اختر لغة واجهة المستخدم.',
                'content.stock.placeholder': 'واجهة إدارة المخزون ستكون هنا.',
                'content.invoice.placeholder': 'واجهة إنشاء الفواتير ستكون هنا.',
                'content.settings.placeholder': 'واجهة الإعدادات ستكون هنا.',
                'stock.search.placeholder': 'ابحث عن المنتجات…',
                'stock.add': 'إضافة',
                'stock.edit': 'تعديل',
                'stock.delete': 'حذف',
                'stock.restock': '+ إضافة مخزون',
                'stock.consume': '- خصم من المخزون',
                'stock.btn.adjust': 'تعديل…',
                'stock.btn.transfer': 'تحويل…',
                'stock.btn.batch': 'الدفعة/الصلاحية…',
                'stock.btn.reorder': 'إعادة ترتيب',
                'stock.btn.stocktake': 'جرد…',
                'stock.btn.history': 'السجل…',
                'stock.btn.export': 'تصدير…',
                'stock.col.id': 'المعرف',
                'stock.col.name': 'الاسم',
                'stock.col.barcode': 'الباركود',
                'stock.col.quantity': 'الكمية',
                'stock.col.price': 'السعر',
                'stock.col.code': 'الرمز',
                'stock.col.category': 'الفئة',
                'stock.col.expiry': 'الصلاحية',
                'stock.col.location': 'الموقع',
                'stock.col.status': 'الحالة',
                'stock.all_locations': 'كل المواقع',
                'stock.form.barcode': 'الباركود',
                'stock.form.sku': 'رمز SKU',
                'stock.form.name': 'الاسم',
                'stock.form.category': 'الفئة',
                'stock.form.quantity': 'الكمية',
                'stock.form.unit': 'الوحدة',
                'stock.form.cost_price': 'سعر التكلفة',
                'stock.form.selling_price': 'سعر البيع',
                'stock.form.expiry_date': 'تاريخ الصلاحية',
                'stock.form.location': 'الموقع',
                'stock.form.reorder_level': 'حد إعادة الطلب',
                'stock.form.supplier': 'المورّد',
                'stock.form.batch_no': 'رقم الدفعة',
                'stock.form.mfg_date': 'تاريخ التصنيع',
                'stock.form.notes': 'ملاحظات',
                'stock.more_details.show': 'مزيد من التفاصيل ▾',
                'stock.more_details.hide': 'مزيد من التفاصيل ▴',
                'stock.dialog.name': 'الاسم',
                'stock.dialog.barcode': 'الباركود',
                'stock.dialog.description': 'الوصف',
                'stock.dialog.quantity': 'الكمية',
                'stock.dialog.price': 'السعر',
                'stock.adjust.title': 'تعديل المخزون',
                'stock.adjust.amount': 'الكمية',
                'stock.scan.placeholder': 'امسح أو اكتب الباركود ثم اضغط Enter',
                'stock.scan.exists_prompt': 'المنتج موجود. زيادة المخزون بمقدار 1؟',
                'msg.validation': 'تحقق',
                'msg.name_required': 'الاسم مطلوب',
                'msg.select_product': 'اختر منتجًا أولاً',
                'msg.select_to_edit': 'اختر منتجًا لتعديله',
                'msg.select_to_delete': 'اختر منتجًا لحذفه',
                'msg.error': 'خطأ',
                'msg.failed_add': 'فشل إضافة المنتج. يجب أن يكون الاسم فريدًا.',
                'msg.failed_update': 'فشل تحديث المنتج (هل الاسم مكرر؟)',
                'msg.failed_delete': 'فشل حذف المنتج',
                'msg.failed_adjust': 'فشل تعديل المخزون',
                'msg.confirm': 'تأكيد',
                'msg.confirm_delete': 'هل تريد حذف المنتج المحدد؟',
                
                # Business Information
                'business.name': '??? ????',
                'business.address': '???? ?????',
                'business.phone_landline': '???? ?????',
                'business.phone_mobile': '???? ???',
                'business.fax': '????',
                'business.email': '??? ?????',
                'business.bank_identity': '??? ????? ?????',
                'business.bank_name': '??? ???',
                'business.company_id': '????? ?????? ????',
                'business.tax_id': '????? ?????',
                'business.patente': '??? ?????',
                'business.trade_register': '??? ??????? ?????',
            },
        }

    def set_language(self, lang: str) -> None:
        if lang in self.SUPPORTED:
            self._lang = lang
        else:
            self._lang = 'en'

    def get_language(self) -> str:
        return self._lang

    def is_rtl(self) -> bool:
        return self._lang == 'ar'

    def tr(self, key: str) -> str:
        return self._translations.get(self._lang, {}).get(key, self._translations['en'].get(key, key))


# Global singleton for simplicity of access
language_manager = LanguageManager()
